import{a as T,b as k}from"./chunk-UXBQWYA2.js";import{i as C,r as w,s as _,t as y,u as P,v as I}from"./chunk-NI7OY2TA.js";import{a as D}from"./chunk-CVD3T6AB.js";import{f as v}from"./chunk-SPIBSKG6.js";import{a as M}from"./chunk-X3KPJDVG.js";import{C as m,Ec as b,Fa as d,Fb as u,Ka as o,Ra as f,Z as g,gc as S,ib as l,jb as r,kb as s,lb as h,qb as c}from"./chunk-S46BXV3G.js";var O=class p{constructor(e,i,t,n,a){this.studentService=e;this.cdr=i;this.dialog=t;this.confirm=n;this.toast=a}router=g(v);columns=[{label:"ID",field:"id",sortable:!0},{label:"Username",field:"username",sortable:!0},{label:"Email",field:"email",sortable:!0},{label:"Role",field:"role"},{label:"Deleted",field:"isDeleted",pipe:"deletedStatus",sortable:!0}];actions=[{icon:"fas fa-edit",tooltip:"Edit",type:"edit",color:"#007bff"},{icon:"fas fa-trash",tooltip:"Delete",type:"delete",color:"#dc3545"},{icon:"fas fa-eye",tooltip:"View",type:"view",color:"#28a745"}];students=[];loading=!1;searchTerm=new C("");paginationInfo={currentPage:1,totalPages:1,totalItems:0,itemsPerPage:5};currentSort=null;ngOnInit(){this.fetchStudents(),this.searchTerm.valueChanges.pipe(m(400)).subscribe(()=>{this.paginationInfo.currentPage=1,this.fetchStudents()})}fetchStudents(){this.loading=!0;let e=this.searchTerm.value||"",i=this.currentSort?.field||"id",t=this.currentSort?.direction==="desc";this.studentService.getAllStudents(e,i,t,this.paginationInfo.currentPage,this.paginationInfo.itemsPerPage).subscribe({next:n=>{this.students=n.items,this.paginationInfo.totalItems=n.totalItems,this.paginationInfo.totalPages=n.totalPages,this.paginationInfo.currentPage=n.currentPage,this.loading=!1,this.cdr.detectChanges()},error:n=>{console.error("\u274C Error fetching students:",n),this.students=[],this.loading=!1,this.cdr.detectChanges()}})}openDialog(e="add",i){this.dialog.open(k,{data:{title:e==="edit"?"Edit Student":"Add Student",action:e,student:i,formType:"student"},width:"500px"}).afterClosed().subscribe(n=>{n&&(e==="edit"?this.updateStudent(n):this.addStudent(n))})}onActionClick(e){switch(e.type){case"edit":this.editStudent(e.row);break;case"delete":this.deleteStudent(e.row);break;case"view":this.viewStudent(e.row);break}}onPageChange(e){this.paginationInfo.currentPage=e,this.fetchStudents()}onSortChange(e){this.currentSort=e,this.fetchStudents()}addStudent(e){let i={username:e.username,email:e.email,password:e.password||"123456"};this.studentService.addStudent(i).subscribe({next:()=>{this.toast.show("Student added successfully","success"),this.fetchStudents()},error:()=>this.toast.show("Failed to add student","error")})}editStudent(e){this.openDialog("edit",e)}updateStudent(e){let i={username:e.username,email:e.email,password:e.password||""};this.studentService.updateStudent(e.id,i).subscribe({next:()=>{this.toast.show("Student updated successfully","success"),this.fetchStudents()},error:()=>this.toast.show("Failed to update student","error")})}deleteStudent(e){this.confirm.show("Delete Confirmation",`Are you sure you want to delete the student "${e.username}"?`,()=>{this.studentService.deleteStudent(e.id).subscribe({next:()=>{this.toast.show("Student deleted successfully","success"),this.fetchStudents()},error:i=>this.toast.show(i.error.message||"Failed to delete student","error")})},{isSuccess:!1,okText:"Delete"})}viewStudent(e){e?.id&&this.router.navigate(["dashboard/student/result",e.id])}static \u0275fac=function(i){return new(i||p)(o(D),o(S),o(T),o(P),o(I))};static \u0275cmp=f({type:p,selectors:[["app-all-students"]],decls:10,vars:12,consts:[[1,"page-container"],[1,"page-header"],[1,"title"],[1,"description"],[1,"flex","justify-between","items-center","w-100"],["placeholder","Search...","icon","fa-solid fa-magnifying-glass","type","text",1,"search-input",3,"control"],["text","Add Student","icon","fa-solid fa-plus","type","button",1,"add-button",3,"click","loading"],[3,"actionClick","pageChange","sortChange","columns","data","actions","loading","striped","hoverable","caption","paginationInfo","useBackendPagination","currentSort"]],template:function(i,t){i&1&&(r(0,"div",0)(1,"div",1)(2,"h1",2),u(3,"\u{1F393} Students Management"),s(),r(4,"p",3),u(5," Here you can view, search, add, edit, or delete students in the system. "),s()(),r(6,"div",4),h(7,"app-custom-input",5),r(8,"app-button",6),c("click",function(){return t.openDialog()}),s()(),r(9,"app-table",7),c("actionClick",function(a){return t.onActionClick(a)})("pageChange",function(a){return t.onPageChange(a)})("sortChange",function(a){return t.onSortChange(a)}),s()()),i&2&&(d(7),l("control",t.searchTerm),d(),l("loading",t.loading),d(),l("columns",t.columns)("data",t.students)("actions",t.actions)("loading",t.loading)("striped",!0)("hoverable",!0)("caption","Students")("paginationInfo",t.paginationInfo)("useBackendPagination",!0)("currentSort",t.currentSort))},dependencies:[b,M,_,y,w],styles:[".flex[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;gap:16px}.search-input[_ngcontent-%COMP%]{width:50%}.add-button[_ngcontent-%COMP%]{margin-bottom:16px}.search-input[_ngcontent-%COMP%]     .mat-mdc-form-field{width:100%!important}.page-container[_ngcontent-%COMP%]{max-width:1200px;padding:1rem}.page-header[_ngcontent-%COMP%]{margin-bottom:2rem;text-align:center}.page-header[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-size:2rem;font-weight:700;margin-bottom:.5rem}.page-header[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{font-size:1rem;color:#797979}.actions-bar[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem;flex-wrap:wrap;gap:1rem}"]})};export{O as AllStudents};
